generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}


model chitietdatsan {
  id         Int       @id @default(autoincrement())           // INT AUTO_INCREMENT
  datSanId   Int
  sanPhamId  Int
  giaBan     Float     @db.Float                               // FLOAT
  soLuong    Int       @db.SmallInt                            // SMALLINT (vì số lượng thường nhỏ)
  ghiChu     String?   @db.VarChar(255)                        // VARCHAR(255) NULL
  trangThai  Int       @db.TinyInt                             // TINYINT
  createdAt  DateTime  @default(now())                         // DATETIME DEFAULT CURRENT_TIMESTAMP
  updatedAt  DateTime  @updatedAt                              // DATETIME ON UPDATE CURRENT_TIMESTAMP

  datsan     datsan    @relation(fields: [datSanId], references: [id])
  sanpham    sanpham   @relation(fields: [sanPhamId], references: [id])

  @@index([datSanId])
  @@index([sanPhamId])
}


model chitietquyen {
  id            Int              @id @default(autoincrement())         // INT AUTO_INCREMENT PRIMARY KEY
  chucNangId    Int
  nhomQuyenId   Int
  hanhDong      String           @db.VarChar(50)                      // VARCHAR(50)
  moTa          String?          @db.Text                             // TEXT NULL
  trangThai     Int              @db.TinyInt                          // TINYINT
  createdAt     DateTime         @default(now())                      // DATETIME DEFAULT CURRENT_TIMESTAMP
  updatedAt     DateTime         @updatedAt                           // DATETIME ON UPDATE CURRENT_TIMESTAMP

  chucnang      danhmucchucnang  @relation(fields: [chucNangId], references: [id])
  nhomquyen     nhomquyen        @relation(fields: [nhomQuyenId], references: [id])

  @@index([chucNangId])
  @@index([nhomQuyenId])
}


model danhmucchucnang {
  id            Int              @id @default(autoincrement())       // INT AUTO_INCREMENT PRIMARY KEY
  maChucNang    String           @unique @db.VarChar(20)             // VARCHAR(20) UNIQUE
  tenChucNang   String           @db.VarChar(50)                     // VARCHAR(50)
  moTa          String?          @db.Text                            // TEXT NULL
  trangThai     Int              @db.TinyInt                         // TINYINT
  createdAt     DateTime         @default(now())                     // DATETIME DEFAULT CURRENT_TIMESTAMP
  updatedAt     DateTime         @updatedAt                          // DATETIME ON UPDATE CURRENT_TIMESTAMP

  chitietquyen  chitietquyen[]
}


model datsan {
  id            Int             @id @default(autoincrement())         // INT AUTO_INCREMENT PRIMARY KEY
  maDatSan      String          @db.VarChar(20)                       // VARCHAR(20)
  sanId         Int
  khachHangId   Int
  nhanVienId    Int
  ngayDat       DateTime                                              // DATETIME
  checkIn       DateTime                                              // DATETIME
  checkOut      DateTime                                              // DATETIME
  giaSan        Float           @db.Float                             // FLOAT
  tongTien      Float?          @db.Float                             // FLOAT NULL
  thanhToan     String?         @db.VarChar(50)                       // VARCHAR(50) NULL
  ghiChu        String?         @db.Text                              // TEXT NULL
  trangThai     Int             @db.TinyInt                           // TINYINT
  createdAt     DateTime        @default(now())                       // DATETIME DEFAULT CURRENT_TIMESTAMP
  updatedAt     DateTime        @updatedAt                            // DATETIME ON UPDATE CURRENT_TIMESTAMP

  chitietdatsan chitietdatsan[]
  khachhang     khachhang       @relation(fields: [khachHangId], references: [id])
  nhanvien      nhanvien        @relation(fields: [nhanVienId], references: [id])
  san           san             @relation(fields: [sanId], references: [id])

  @@index([khachHangId])
  @@index([nhanVienId])
  @@index([sanId])
}


model giathue {
  id            Int        @id @default(autoincrement())         // INT AUTO_INCREMENT PRIMARY KEY
  sanId         Int
  khungGioId    Int
  thuTrongTuan  String?    @db.VarChar(10)                       // VARCHAR(10) NULL (ví dụ: "Mon", "T2", "CN")
  giaTien       Float      @db.Float                             // FLOAT
  moTa          String?    @db.Text                              // TEXT NULL
  trangThai     Int        @db.TinyInt                           // TINYINT
  createdAt     DateTime   @default(now())                       // DATETIME DEFAULT CURRENT_TIMESTAMP
  updatedAt     DateTime   @updatedAt                            // DATETIME ON UPDATE CURRENT_TIMESTAMP

  khunggio      khunggio   @relation(fields: [khungGioId], references: [id])
  san           san        @relation(fields: [sanId], references: [id])

  @@index([khungGioId])
  @@index([sanId])
}


model khachhang {
  id          Int       @id @default(autoincrement())          // INT AUTO_INCREMENT PRIMARY KEY
  hoTen       String    @db.VarChar(100)                       // VARCHAR(100)
  email       String?   @unique @db.VarChar(100)               // VARCHAR(100) NULL UNIQUE
  cccd        String?   @unique @db.VarChar(20)                // VARCHAR(20) NULL UNIQUE
  soDienThoai String    @unique @db.VarChar(15)                // VARCHAR(15) UNIQUE
  gioiTinh    Int?      @db.TinyInt                            // TINYINT NULL
  diaChi      String?   @db.Text                               // TEXT NULL
  ngaySinh    DateTime? @db.Date                               // DATE NULL
  trangThai   Int       @db.TinyInt                            // TINYINT
  createdAt   DateTime  @default(now())                        // DATETIME DEFAULT CURRENT_TIMESTAMP
  updatedAt   DateTime  @updatedAt                             // DATETIME ON UPDATE CURRENT_TIMESTAMP

  datsan      datsan[]
}


model khunggio {
  id          Int        @id @default(autoincrement())        // INT AUTO_INCREMENT PRIMARY KEY
  gioBatDau   String     @db.VarChar(10)                      // VARCHAR(10): VD "07:00"
  gioKetThuc  String     @db.VarChar(10)                      // VARCHAR(10): VD "08:30"
  moTa        String?    @db.Text                             // TEXT (NULLABLE)
  trangThai   Int        @db.TinyInt                          // TINYINT (0 hoặc 1)
  createdAt   DateTime   @default(now())                      // DATETIME DEFAULT CURRENT_TIMESTAMP
  updatedAt   DateTime   @updatedAt                           // DATETIME ON UPDATE CURRENT_TIMESTAMP

  giathue     giathue[]
}


model loaisan {
  id          Int      @id @default(autoincrement())              // INT AUTO_INCREMENT PRIMARY KEY
  tenLoaiSan  String   @db.VarChar(50) @unique                    // VARCHAR(50) NOT NULL
  moTa        String?  @db.Text                                   // TEXT NULL
  trangThai   Int      @db.TinyInt                                // TINYINT NOT NULL
  createdAt   DateTime @default(now())                            // DATETIME DEFAULT CURRENT_TIMESTAMP
  updatedAt   DateTime @updatedAt                                 // DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE ...
  san         san[]
}


model loaisanpham {
  id               Int        @id @default(autoincrement())         // INT AUTO_INCREMENT
  tenLoaiSanPham   String     @db.VarChar(100) @unique              // VARCHAR(100)
  moTa             String?    @db.Text                              // TEXT (NULLABLE)
  trangThai        Int        @db.TinyInt                           // TINYINT
  createdAt        DateTime   @default(now())                       // DATETIME DEFAULT CURRENT_TIMESTAMP
  updatedAt        DateTime   @updatedAt                            // DATETIME ON UPDATE CURRENT_TIMESTAMP

  sanpham          sanpham[]                                        // Quan hệ 1-n đến bảng `sanpham`
}


model nhanvien {
  id          Int        @id @default(autoincrement())                 // INT AUTO_INCREMENT
  hoTen       String     @db.VarChar(100)                              // VARCHAR(100)
  email       String     @unique @db.VarChar(100)                      // VARCHAR(100) UNIQUE
  cccd        String?    @unique @db.VarChar(20)                       // VARCHAR(20) UNIQUE NULLABLE
  soDienThoai String     @unique @db.VarChar(20)                       // VARCHAR(20) UNIQUE
  gioiTinh    Int?       @db.TinyInt                                   // TINYINT (NULLABLE)
  diaChi      String?    @db.VarChar(255)                              // VARCHAR(255) (NULLABLE)
  ngaySinh    DateTime?                                                // DATETIME (NULLABLE)
  hinhAnh     String?    @db.VarChar(255)                              // VARCHAR(255) (NULLABLE)
  trangThai   Int        @db.TinyInt                                   // TINYINT
  createdAt   DateTime   @default(now())                               // DATETIME DEFAULT CURRENT_TIMESTAMP
  updatedAt   DateTime   @updatedAt                                    // DATETIME ON UPDATE CURRENT_TIMESTAMP

  datsan      datsan[]                                                 // 1-n với bảng `datsan`
  taikhoan    taikhoan[]                                               // 1-n với bảng `taikhoan`
}


model nhomquyen {
  id            Int             @id @default(autoincrement())             // INT AUTO_INCREMENT
  maQuyen       String          @unique @db.VarChar(50)                   // VARCHAR(50) UNIQUE (ví dụ: "ADMIN", "NHANVIEN", ...)
  tenQuyen      String          @db.VarChar(100)                          // VARCHAR(100)
  moTa          String?         @db.VarChar(255)                          // VARCHAR(255) NULLABLE
  trangThai     Int             @db.TinyInt                               // TINYINT
  createdAt     DateTime        @default(now())                           // DATETIME DEFAULT CURRENT_TIMESTAMP
  updatedAt     DateTime        @updatedAt                                // DATETIME ON UPDATE CURRENT_TIMESTAMP

  chitietquyen  chitietquyen[]                                           // Quan hệ 1-n với chitietquyen
  taikhoan      taikhoan[]                                               // Quan hệ 1-n với taikhoan
}


model san {
  id          Int       @id @default(autoincrement())
  loaiSanId   Int
  tenSan      String    @db.VarChar(50) @unique         // VARCHAR(50)
  giaSan      Float     @db.Float               // FLOAT
  moTa        String?   @db.Text                // TEXT (nullable)
  hinhAnh     String?   @db.VarChar(255)        // VARCHAR(255) (nullable)
  trangThai   Int       @db.TinyInt             // TINYINT (nếu chỉ 0/1 hoặc ít trạng thái)
  createdAt   DateTime  @default(now())         // DATETIME DEFAULT CURRENT_TIMESTAMP
  updatedAt   DateTime  @updatedAt              // DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE...

  datsan      datsan[]
  giathue     giathue[]
  loaisan     loaisan   @relation(fields: [loaiSanId], references: [id])

  @@index([loaiSanId])
}


model sanpham {
  id              Int             @id @default(autoincrement())              // INT AUTO_INCREMENT
  loaiSanPhamId   Int                                                     // FK -> loaisanpham
  tenSanPham      String          @db.VarChar(100) @unique                         // VARCHAR(100)
  giaSanPham      Float                                                  // FLOAT
  soLuong         Int                                                    // INT
  donViTinh       String          @db.VarChar(20)                           // VARCHAR(20)
  moTa            String?         @db.VarChar(255)                          // VARCHAR(255), NULLABLE
  hinhAnh         String?         @db.VarChar(255)                          // VARCHAR(255), NULLABLE
  trangThai       Int             @db.TinyInt                               // TINYINT
  createdAt       DateTime        @default(now())                           // DATETIME DEFAULT NOW()
  updatedAt       DateTime        @updatedAt                                // DATETIME ON UPDATE CURRENT_TIMESTAMP

  chitietdatsan   chitietdatsan[]                                           // Quan hệ 1-n
  loaisanpham     loaisanpham     @relation(fields: [loaiSanPhamId], references: [id])

  @@index([loaiSanPhamId])
}


model taikhoan {
  id                  Int        @id @default(autoincrement())               // INT AUTO_INCREMENT
  nhanVienId          Int                                               
  nhomQuyenId         Int
  tenDangNhap         String     @unique @db.VarChar(50)                     // VARCHAR(50)
  matKhau             String     @db.VarChar(255)                            // Hashed password
  emailDaXacThuc      Boolean?                                               // NULLABLE BOOLEAN
  otpQuenMatKhau      String?    @db.VarChar(10)                             // OTP (optional)
  otpHetHanLuc        DateTime?                                              // Expiry of OTP
  refreshToken        String?    @db.VarChar(255)                            // Optional refresh token
  trangThai           Int        @db.TinyInt                                 // TINYINT: 0/1/2 (active, banned, etc.)
  createdAt           DateTime   @default(now())
  updatedAt           DateTime   @updatedAt

  nhanvien            nhanvien   @relation(fields: [nhanVienId], references: [id])
  nhomquyen           nhomquyen  @relation(fields: [nhomQuyenId], references: [id])

  @@index([nhanVienId])
  @@index([nhomQuyenId])
}
